<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure RSS retirements from RSS feeds</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1em; }
        h1 { color: #0078D4; }
        .feed-container { margin-bottom: 20px; padding: 10px;border: 2px solid #ddd; border-radius: 8px; background: #f9f9f9; position: relative; }
        .feed-item { margin-bottom: 15px; }
        .feed-item a { text-decoration: none; color: #0078D4; font-weight: bold; }
        .feed-item a:hover { text-decoration: underline; }
        .add-feed { margin-bottom: 20px; }
        textarea, button { padding: 10px; width: 100%; }
        button { background: #0078D4; color: white; border: none; cursor: pointer; margin-top: 10px; padding: 12px; }
        button:hover { background: #005a9e; }
        .local-storage-container { margin-top: 20px; margin-bottom: 20px; padding: 15px; background: #e9e9e9; border: 1px solid #ccc; border-radius: 8px; }
        .accordion { background-color: #0078D4; color: white; cursor: pointer; padding: 10px; width: 100%; border: none; text-align: center; outline: none; transition: 0.4s; }
        .accordion:hover { background-color: #005a9e; } .panel { padding: 0 18px; display: none; background-color: white; overflow: hidden; }
        .clear-btn { background: #ff4d4d; color: white; border: none; cursor: pointer; margin-top: 10px; padding: 12px; width: 100%; }
        .clear-btn:hover { background: #cc0000; }
        .show-btn { background: #f59221; color: white; border: none; cursor: pointer; margin-top: 10px; padding: 12px; width: 100%; }
        .show-btn:hover { background: #f0860e; }
    </style>
</head>
<body>

    <h1>Latest Azure retirements from RSS feeds</h1>

    <div id="rss-feeds"></div>

    <script>
        const defaultFeeds = [
            { name: "Azure Update", url: "https://www.microsoft.com/releasecommunications/api/v2/azure/rss" },
        ];

        let feeds = [];

        function loadFeeds() {
            const savedFeeds = JSON.parse(localStorage.getItem("rssFeeds"));
            feeds = savedFeeds && savedFeeds.length > 0 ? savedFeeds : [...defaultFeeds];
            document.getElementById("rss-feeds").innerHTML = "";
            feeds.forEach(feed => fetchRSSFeed(feed));
        }

        async function fetchRSSFeed(feed) {
            const apiKey = 'yzkycign0wt3c7nnvsrriqffk6fcv1uk1bzsqtlz';
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}&api_key=${apiKey}&count=1000`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.status === "ok") {
                    const container = document.getElementById("rss-feeds");

                    if (document.getElementById(`feed-${btoa(feed.url)}`)) return;

                    let feedSection = document.createElement("div");
                    feedSection.className = "feed-container";
                    feedSection.id = `feed-${btoa(feed.url)}`;
                    feedSection.innerHTML = `<h2>From: <a href="${feed.url}" target="_blank">${feed.name}</a></h2>`;

                    if (!defaultFeeds.some(f => f.url === feed.url)) {
                        let removeButton = document.createElement("button");
                        removeButton.className = "remove-btn";
                        removeButton.innerText = "Remove";
                        removeButton.addEventListener("click", function() {
                            removeFeed(feed.url);
                        });
                        feedSection.appendChild(removeButton);
                    }

                    const filteredItems = data.items.filter(item =>
                        item.categories.includes("Retirements") || item.title.includes("Retirement")
                    );

                    const sortedItems = filteredItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

                    const lastItems = sortedItems.slice(0, 3000).map(item => `
                        <div class="feed-item">
                            <p><small>
                            ${new Date() - new Date(item.pubDate) < 2 * 24 * 60 * 60 * 1000 ? 'ðŸŸ¢' : 'ðŸ”µ'} ${new Date(item.pubDate).toDateString()}
                            : </small>
                            <a href="${item.link}" target="_blank">${item.title}</a></p>
                        </div>
                    `).join('');

                    feedSection.innerHTML += lastItems;
                    container.appendChild(feedSection);
                }
            } catch (error) {
                console.error(`Error fetching RSS feed: ${feed.name}`, error);
            }
        }

        document.addEventListener("DOMContentLoaded", loadFeeds);
    </script>

</body>
</html>
